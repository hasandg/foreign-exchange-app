databaseChangeLog:
  - changeSet:
      id: 04-batch-job-instance-sequence
      author: hasandag
      context: local,docker
      preConditions:
        - onFail: MARK_RAN
        - tableExists:
            tableName: batch_job_instance
      changes:
        - sql:
            sql: "ALTER TABLE batch_job_instance ALTER COLUMN job_instance_id SET DEFAULT nextval('batch_job_instance_seq');"
        - sql:
            sql: "ALTER SEQUENCE batch_job_instance_seq OWNED BY batch_job_instance.job_instance_id;"
        - sql:
            sql: "SELECT setval('batch_job_instance_seq', COALESCE((SELECT MAX(job_instance_id) FROM batch_job_instance), 0) + 1, false);"

  - changeSet:
      id: 04-batch-job-execution-sequence
      author: hasandag
      context: local,docker
      preConditions:
        - onFail: MARK_RAN
        - tableExists:
            tableName: batch_job_execution
      changes:
        - sql:
            sql: "ALTER TABLE batch_job_execution ALTER COLUMN job_execution_id SET DEFAULT nextval('batch_job_execution_seq');"
        - sql:
            sql: "ALTER SEQUENCE batch_job_execution_seq OWNED BY batch_job_execution.job_execution_id;"
        - sql:
            sql: "SELECT setval('batch_job_execution_seq', COALESCE((SELECT MAX(job_execution_id) FROM batch_job_execution), 0) + 1, false);"

  - changeSet:
      id: 04-batch-step-execution-sequence
      author: hasandag
      context: local,docker
      preConditions:
        - onFail: MARK_RAN
        - tableExists:
            tableName: batch_step_execution
      changes:
        - sql:
            sql: "ALTER TABLE batch_step_execution ALTER COLUMN step_execution_id SET DEFAULT nextval('batch_step_execution_seq');"
        - sql:
            sql: "ALTER SEQUENCE batch_step_execution_seq OWNED BY batch_step_execution.step_execution_id;"
        - sql:
            sql: "SELECT setval('batch_step_execution_seq', COALESCE((SELECT MAX(step_execution_id) FROM batch_step_execution), 0) + 1, false);" 